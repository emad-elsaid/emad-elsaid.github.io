<!DOCTYPE html>
<html lang="en-us">
	<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Emad Elsaid">
<meta name="description" content="Ruby/Go Web Developer">
<meta name="generator" content="Hugo 0.35" />
<title>Posting to Hugo Static Site From a Facebook Profile</title>
<link rel="shortcut icon" href="http://www.emadelsaid.com/images/favicon.ico">
<link rel="stylesheet" href="http://www.emadelsaid.com/css/style.css">
<link rel="stylesheet" href="http://www.emadelsaid.com/css/highlight.css">

<link rel="stylesheet" href="http://www.emadelsaid.com/css/custom_style.css">



<link rel="stylesheet" href="http://www.emadelsaid.com/css/monosocialiconsfont.css">



<link href="http://www.emadelsaid.com/index.xml" rel="alternate" type="application/rss+xml" title="Emad Elsaid" />


<meta property="og:title" content="Posting to Hugo Static Site From a Facebook Profile" />
<meta property="og:description" content="Hugo is a static site generator, it&rsquo;s very fast generator built on Go, it can convert markdown and org files into a beautiful blog, I use it for my blog.
My current setup is a Hugo repository that is served from GitHub pages, linked it to my domain emadelsaid.com, whenever I need to post a new post I use spacemacs and a package called easyhugo to create a new post, then a function called easy-hugo-github-deploy that regenerates the site, commit and deploy it, it&rsquo;s all open source, you can check it out from this repository." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.emadelsaid.com/posts/posting-to-hugo-static-site-from-a-facebook-profile/" />



<meta property="article:published_time" content="2018-02-05T00:01:38&#43;01:00"/>

<meta property="article:modified_time" content="2018-02-05T00:01:38&#43;01:00"/>













<meta itemprop="name" content="Posting to Hugo Static Site From a Facebook Profile">
<meta itemprop="description" content="Hugo is a static site generator, it&rsquo;s very fast generator built on Go, it can convert markdown and org files into a beautiful blog, I use it for my blog.
My current setup is a Hugo repository that is served from GitHub pages, linked it to my domain emadelsaid.com, whenever I need to post a new post I use spacemacs and a package called easyhugo to create a new post, then a function called easy-hugo-github-deploy that regenerates the site, commit and deploy it, it&rsquo;s all open source, you can check it out from this repository.">


<meta itemprop="datePublished" content="2018-02-05T00:01:38&#43;01:00" />
<meta itemprop="dateModified" content="2018-02-05T00:01:38&#43;01:00" />
<meta itemprop="wordCount" content="716">



<meta itemprop="keywords" content="" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Posting to Hugo Static Site From a Facebook Profile"/>
<meta name="twitter:description" content="Hugo is a static site generator, it&rsquo;s very fast generator built on Go, it can convert markdown and org files into a beautiful blog, I use it for my blog.
My current setup is a Hugo repository that is served from GitHub pages, linked it to my domain emadelsaid.com, whenever I need to post a new post I use spacemacs and a package called easyhugo to create a new post, then a function called easy-hugo-github-deploy that regenerates the site, commit and deploy it, it&rsquo;s all open source, you can check it out from this repository."/>
<meta name="twitter:site" content="@https://www.twitter.com/emad__elsaid"/>


    </head>
<body>
    <nav class="main-nav">
	
		<a href='http://www.emadelsaid.com/'> <span class="arrow">←</span>All Articles</a>
	

	

	
		<a class="cta" href="http://www.emadelsaid.com/index.xml">RSS</a>
	
</nav>

    <section id="wrapper">
        
        
<article class="post">
    <header>
        <h1>Posting to Hugo Static Site From a Facebook Profile</h1>
        <h2 class="headline">
        February 5, 2018
        <br>
        
        </h2>
    </header>
    <section id="post-body">
        

<p><a href="https://gohugo.io/">Hugo is a static site generator</a>, it&rsquo;s very fast generator
built on Go, it can convert markdown and org files into a beautiful blog, I use
it for my blog.</p>

<p>My current setup is a Hugo repository that is served from GitHub pages, linked
it to my domain <code>emadelsaid.com</code>, whenever I need to post a new post I use
spacemacs and a package called
<a href="https://github.com/masasam/emacs-easy-hugo">easyhugo</a> to create a new post,
then a function called <code>easy-hugo-github-deploy</code> that regenerates the site,
commit and deploy it, it&rsquo;s all open source, you can check it out from <a href="https://github.com/emad-elsaid/emad-elsaid.github.io">this
repository</a>.</p>

<p>I needed to create a similar website for my wife, a blog where she writes some
articles about fitness and exercising, but we don&rsquo;t want her to open
spacemacs or any other editor of course, it would be great if she can write the
article on her Facebook profile and it gets magically published to the Hugo
website.</p>

<h1 id="the-theory">The theory</h1>

<ol>
<li>a Hugo blog source directory</li>
<li>a webhook server script

<ul>
<li>it exposes one secret endpoint that accepts POST request</li>
<li>When hit with a Facebook post text, writes it to a new post file, and
regenerates the website</li>
</ul></li>
<li>A web server to serve the public directory generated by Hugo</li>
<li><a href="https://ifttt.com/">IFTTT.com</a> applet to POST to the webhook when a Facebook post is published with
a hashtag</li>
</ol>

<hr />

<h1 id="the-implementation">The implementation</h1>

<h2 id="services">Services</h2>

<p>I use docker compose to serve 2 containers, one of them will have the HTTP
server to serve the actual website, the other will run the webhook script.</p>

<p>the <code>docker-compose.yml</code> file looks like so:</p>

<pre><code class="language-YAML">version: '2'
services:
  refresher:
    build: .
    volumes:
      - /root/data/website/public:/website/public
      - /root/data/website/post:/website/content/post
    restart: always
    ports:
      - '127.0.0.1:9002:8080'
    environment:
      RACK_ENV: production
  web:
    image: &quot;nginx:latest&quot;
    depends_on:
      - refresher
    volumes:
      - /root/data/website/public:/usr/share/nginx/html
    restart: always
    ports:
      - '127.0.0.1:9001:80'

</code></pre>

<p>Two services are there:</p>

<p>Refresher, builds a docker file as follows:</p>

<pre><code class="language-docker">FROM ruby:latest

RUN wget -q https://github.com/gohugoio/hugo/releases/download/v0.30/hugo_0.30_Linux-64bit.deb
RUN dpkg -i hugo_0.30_Linux-64bit.deb

COPY . /website_source
WORKDIR /website_source

RUN bundle
RUN hugo
CMD ./server
</code></pre>

<p>it links 2 volumes one of them is the posts directory where posts will be
written, the other is the public directory generated by Hugo, it should be
served from the second service.</p>

<p>the web service is an out-of-the-box nginx image, links the public directory
generated from the first service to the nginx default HTML.</p>

<h2 id="the-webhook-server">The webhook server</h2>

<p>A ruby script that listens on a port, will wait for a specific path (secret
path segment), with the article text as the POST body in plain text.</p>

<p>It will get the first post line and assume it&rsquo;s the post title, and will create
a post with that title and the rest of the post as the post content text.</p>

<p>The script is very simple, it&rsquo;s as follows:</p>

<pre><code class="language-ruby">#!/usr/bin/env ruby
require 'rack'

secret_path = '/&lt;secret-string-here&gt;'

def write_post(post)
  lines = post.split(&quot;\n&quot;)
  title = lines[0]
  body = lines[1..-1].join(&quot;\n&quot;)
  post_body = &lt;&lt;-END_OF_POST
---
title: &quot;#{title}&quot;
date: #{Time.now}
---
#{body}
END_OF_POST

  File.write(&quot;content/post/#{title}.md&quot;, post_body)
end

def generate_site
  `hugo`
end

app = proc do |env|
  request = Rack::Request.new(env)
  if request.path != secret_path || !request.post?
    [
      301,
      {
        'Location' =&gt; 'http://www.&lt;main-domain-here&gt;.com',
        'Content-Type' =&gt; 'text/html'
      },
      ['Moved Permanently']
    ]
  else
    write_post(request.body.read)
    generate_site
    [200, { 'Content-Type' =&gt; 'text/plain' }, ['OK']]
  end
end

Rack::Handler::WEBrick.run app

</code></pre>

<p>The secret string can be generated with <code>uuid-gen</code> command, or <code>rails secret</code>
command.</p>

<h1 id="ifttt-com">IFTTT.com</h1>

<p>IFTTT has a trigger for Facebook, one of the triggers listens if you posted a
text post with hashtag, you can use it as your trigger.</p>

<p>then it should use a <code>webhook</code>, the URL should be your refresher
<code>domain/secret-path</code>, the method should be POST, and the request body should be
<code>plain/text</code> with the <code>post body without hashtag</code>, and you can use any hashtag
you want for IFTTT to watch.</p>

<h1 id="conclusion">Conclusion</h1>

<p>Now when you deploy that setup to your VPS server, linking your main HTTP proxy
to both these services, I recommend a separate subdomain for your refresher
service. and the www and naked domain to your web server.</p>

<p>The following is what will happen to trigger the whole setup:</p>

<ol>
<li>Post a text status with the hashtag on your profile, first line is the post
title, the rest is your article.</li>
<li>IFTTT.com will be triggered, sending the post to the webhook</li>
<li>Your webhook script will get the request body and writing it to a file, then
executing <code>Hugo</code> to regenerate the HTML.</li>
<li>The HTML is served the the nginx service.</li>
</ol>

    </section>
</article>

<footer id="post-meta" class="clearfix">
    <a href="https://twitter.com/emad__elsaid">
    <img class="avatar" src="http://www.emadelsaid.com/images/avatar.png">
    <div>
        <span class="dark">Emad Elsaid</span>
        <span>Software Engineer, Ruby/Go Web Developer</span>
    </div>
    </a>
    <section id="sharing">
        <a class="twitter" href="https://twitter.com/intent/tweet?text=http%3a%2f%2fwww.emadelsaid.com%2fposts%2fposting-to-hugo-static-site-from-a-facebook-profile%2f - Posting%20to%20Hugo%20Static%20Site%20From%20a%20Facebook%20Profile by @emad__elsaid"><span class="icon-twitter"> tweet</span></a>

<a class="facebook" href="#" onclick="
    window.open(
      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
      'facebook-share-dialog',
      'width=626,height=436');
    return false;"><span class="icon-facebook-rect"> Share</span>
</a>

    </section>
</footer>



<ul id="post-list" class="archive readmore">
    <h3>Read more</h3>

    
    
    
        <li>
            <a href="/posts/how-to-find-a-solution-for-your-problem/">How to Find a Solution for Your Problem<aside class="dates">Feb 3 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/exporting-a-facebook-group-as-a-website/">Exporting a Facebook Group as a Website<aside class="dates">Feb 1 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/erb-templates-as-standalone-executables/">ERB Templates as Standalone Executables<aside class="dates">Jan 24 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/working-with-legacy-code/">Working With Legacy Code<aside class="dates">Jan 21 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/projects-files-flame-graph/">Projects Files Flame Graph<aside class="dates">Jan 21 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/%D8%AA%D9%88%D8%A7%D8%B2%D9%86-%D8%AC%D9%8A%D9%86%D9%8A/">جينات توازن<aside class="dates">Jan 20 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/consistency-over-creativity/">Consistency Over Creativity<aside class="dates">Jan 14 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/golang-bleve-experience/">Golang Bleve Experience<aside class="dates">Jan 13 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/bind-remote-server-port-to-local-machine-with-ssh/">Bind Remote Server Port to Local Machine With SSH<aside class="dates">Jan 8 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/deploy-rails-application-with-docker-compose-and-capistrano/">Deploy rails application with docker compose and capistrano<aside class="dates">May 31 2016</aside></a>
        </li>
    
</ul>



        <footer id="footer">
    
        <div id="social">

	
	
    
    <a class="symbol" href="https://www.facebook.com/emad.elsaid.hamed">
        roundedfacebook
    </a>
    
    <a class="symbol" href="https://www.github.com/emad-elsaid">
        roundedgithub
    </a>
    
    <a class="symbol" href="https://www.twitter.com/emad__elsaid">
        roundedtwitterbird
    </a>
    


</div>

    
    <p class="small">
    
        © Copyright 2018 Emad Elsaid
    
    </p>
</footer>

    </section>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="http://www.emadelsaid.com/js/main.js"></script>
<script src="http://www.emadelsaid.com/js/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-112396214-1', 'auto');
ga('send', 'pageview');
</script>


</body>
</html>
